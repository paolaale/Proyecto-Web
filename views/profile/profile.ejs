<%- include("../header") -%>
<link rel="stylesheet" href="body.css">
<link rel="stylesheet" href="profile.css">

<body>
    <%- include("./../../components/navbar") -%>

    <div class="flex justify-between flex-col md:flex-row mt-3">

        <section class="w-11/12 md:w-1/5 mx-auto md:mx-0 mb-4 md:mb-0 md:px-3 rounded-lg">
            <div class="flex items-center justify-center shadow-lg">
                <div class="bg-white rounded-lg">
                    <div class="flex items-center justify-center flex-col">
                        <h1 class="text-gray-800 font-semibold text-xl mt-5"> <%= user.name%> </h1>
                        <h1 class="text-gray-500 text-sm"> <%= user.email%> </h>
                    </div>
                    <div class="w-1/2 mx-auto my-3">
                        <img src=<%= user.imageProfile %> alt="user-img" className="h-full w-full object-cover" />
                    </div>

                    <div class="flex justify-between p-4">
                        <div>
                            <h1 class="text-md">Score</h1>
                            <h1 class="text-lg"> <%= user.score%> </h>
                        </div>
                        <button id="edit-button"
                            class="outline w-16 font-semibold text-xs text-white bg-green-700 border-2 py-1 px-2">
                            Editar
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <section id="profile-info" class="w-11/12 md:w-3/4 mx-auto md:mx-0 pt-3 bg-white rounded-lg shadow-lg">
            <div class="flex flex-col lg:flex-row items-center justify-around mt-5">

                <aside class="bg-white rounded-lg shadow-lg w-fixed p-2 h-40">
                    <h1 class="text-center">PROBLEMAS</h1>
                    <hr class=" w-1/2 my-2 mx-auto">
                    <div class="flex justify-between mt-2">
                        <h1 class="text-green-700 font-semibold">Fácil</h1>
                        <p> <%= user.problemSetDifficulty.easy %> </p>
                    </div>
                    <div class="flex justify-between mt-1">
                        <p class="text-orange-500 font-semibold ">Medio</p>
                        <p> <%= user.problemSetDifficulty.medium %></p>
                    </div>
                    <div class="flex justify-between mt-1">
                        <p class="text-red-600 font-semibold">Difícil</p>
                        <p> <%= user.problemSetDifficulty.hard %> </p>
                    </div>
                    <div class="flex justify-between mt-2">
                        <p class="font-semibold"> Totales </p>
                        <p> <%= user.problemSetDifficulty.easy + user.problemSetDifficulty.medium + user.problemSetDifficulty.hard %>
                        </p>
                    </div>
                </aside>

                <aside class="bg-white mt-6 lg:mt-0 rounded-lg shadow-lg w-fixed p-2 h-60">
                    <h1 class="text-center">RÁFAGAS</h1>
                    <hr class=" w-1/2 my-2 mx-auto">
                    <div class="flex justify-between mt-2">
                        <h1 class="text-add font-semibold">Sumas</h1>
                        <p> <%= user.burstTopics.additions %> </p>
                    </div>
                    <div class="flex justify-between mt-1">
                        <h1 class="text-subs font-semibold">Restas</h1>
                        <p> <%= user.burstTopics.substractions %> </p>
                    </div>
                    <div class="flex justify-between mt-1">
                        <h1 class="text-mult font-semibold">Multiplicaciones</h1>
                        <p> <%= user.burstTopics.multiplications %> </p>
                    </div>
                    <div class="flex justify-between mt-1">
                        <h1 class="text-div font-semibold">Divisiones</h1>
                        <p> <%= user.burstTopics.divisions %> </p>
                    </div>
                    <div class="flex justify-between mt-1">
                        <h1 class="text-frac font-semibold">Fracciones</h1>
                        <p> <%= user.burstTopics.fractions %> </p>
                    </div>
                    <div class="flex justify-between mt-1">
                        <h1 class="text-comb font-semibold">Combinada</h1>
                        <p> <%= user.burstTopics.mixed %> </p>
                    </div>
                </aside>
            </div>

            <div class="flex flex-col lg:flex-row items-center justify-around my-12">
                <div class="md:w-1/2 lg:w-2/6">
                    <canvas id="myProblemsChart" width="200" height="200"></canvas>
                </div>

                <div class="md:w-1/2 lg:w-2/6">
                    <canvas id="myBurstsChart" width="200" height="200"></canvas>
                </div>
            </div>

        </section>

        <section id="profile-edit" class="w-11/12 md:w-3/4 mx-auto md:mx-0 pt-3 bg-white rounded-lg shadow-lg hidden">
            <form class="flex-100" action="/profile" method="POST" name="editProfileForm">
                <div class="flex flex-100 mx-8">
                    <div class="flex-grow mr-2">
                        <label class=" block mb-1 font-bold" for="">Nombre</label>
                        <input class="bg-gray-200 w-full rounded-lg py-3 px-3 shadow-inner outline" type="text"
                            name="name" id="name" value=<%=user.name%>>
                    </div>
                    <div class="flex-grow ml-2">
                        <label class=" block mb-1 font-bold" for="">Apellido</label>
                        <input class="bg-gray-200 w-full rounded-lg py-3 px-3 shadow-inner outline" type="text"
                            name="lastName" , id="lastName" value=<%=user.lastName%>>
                    </div>
                </div>
                <div class="flex flex-100 mt-4 mx-8">
                    <div class="flex-grow mr-2">
                        <label class=" block mb-1 font-bold" for="">Escuela</label>
                        <input class="bg-gray-200 w-full rounded-lg py-3 px-3 shadow-inner outline" type="text"
                            name="school" , id="school" value=<%=user.school%>>
                    </div>
                </div>
                <div class="flex flex-100 mx-8">
                    <div class="flex-grow mr-2">
                        <label class=" block mb-1 font-bold" for="">Correo electrónico</label>
                        <input class="bg-gray-400 w-full rounded-lg py-3 px-3 shadow-inner cursor-not-allowed outline"
                            type="email" name="email" , id="email" disabled value=<%=user.email%>>
                    </div>
                </div>
                <div class="flex flex-100 mt-4 mx-8">
                    <div class="flex-grow mr-2">
                        <label class=" block mb-1 font-bold" for="">Nueva contraseña</label>
                        <input class="bg-gray-200 w-full rounded-lg py-3 px-3 shadow-inner outline" type="password"
                            name="password" , id="password">
                    </div>
                </div>

                <div class="mt-4 mx-8">
                    <h1 class="font-bold mb-2">Elige una nueva foto de perfil: </h1>
                    <input type="text" name="imageProfile" id="imageProfile" class="hidden">
                    <div class="flex justify-around flex-wrap p-1">
                        <% images.forEach(image => {  %>
                        <img class="img-option inline mx-5 my-3 p-4" src=<%=image%> data-image=<%=image%>>
                        <% }); %>
                    </div>
                </div>

                <hr class="w-3/4 mx-auto my-6">

                <div class="flex justify-center flex-100 mt-4 mx-8 mb-8">
                    <button
                        class="bg-blue-500 hover:bg-blue-400  font-bold py-2 px-4 border-b-4 border-blue-700 hover:border-blue-500 rounded"
                        type="submit">
                        Guardar
                    </button>
                </div>
            </form>
        </section>

    </div>
</body>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>

<script>

    let userInfo = '<%- JSON.stringify(user) %>';
    userInfo = JSON.parse(userInfo);
    const { problemSetDifficulty } = userInfo;

    const easy = problemSetDifficulty.easy;
    const medium = problemSetDifficulty.medium
    const hard = problemSetDifficulty.hard;

    const ctx = document.getElementById('myProblemsChart');
    const DoughnutData = {
        datasets: [{
            data: [
                easy,
                medium,
                hard
            ],
            backgroundColor: [
                'rgba(0, 256, 0, 0.5)',
                'rgba(251, 140, 0, 0.5)',
                'rgba(256, 0, 0, 0.5)'
            ],
            borderColor: [
                'rgba(0, 256, 0, 1)',
                'rgba(251, 140, 0, 1)',
                'rgba(256, 0, 0, 1)'
            ],
            hoverBackgroundColor: [
                'rgba(0, 256, 0, 1)',
                'rgba(251, 140, 0, 1)',
                'rgba(256, 0, 0, 1)'
            ]
        }],
        labels: [
            'Fácil',
            'Medio',
            'Difícil'
        ]
    };
    const DoughnutChart = new Chart(ctx, {
        type: 'doughnut',
        data: DoughnutData
    });

    //SEGUNDA GRAFICA
    const { burstTopics } = userInfo;

    const sumas = burstTopics.additions;
    const restas = burstTopics.substractions;
    const multiplicaciones = burstTopics.multiplications;
    const divisiones = burstTopics.divisions;
    const fracciones = burstTopics.fractions;
    const combinada = burstTopics.mixed;

    const ctx2 = document.getElementById('myBurstsChart');
    const DoughnutData2 = {
        datasets: [{
            data: [
                sumas,
                restas,
                multiplicaciones,
                divisiones,
                fracciones,
                combinada

            ],
            backgroundColor: [
                '#FF414D',
                '#F39233',
                '#F1E189',
                '#B8DE6F',
                '#01C5C4',
                '#AF8BAF'
            ],
            borderColor: [
                '#EE0011',
                '#E87B0E',
                '#EBD553',
                '#9FD23A',
                '#01AFAB',
                '#966896'
            ],
            hoverBackgroundColor: [
                '#EE0011',
                '#E87B0E',
                '#EBD553',
                '#9FD23A',
                '#01AFAB',
                '#966896'
            ]
        }],
        labels: [
            'Sumas',
            'Restas',
            'Multiplicaciones',
            'Divisiones',
            'Fracciones',
            'Combinada'
        ]
    };
    const DoughnutChart2 = new Chart(ctx2, {
        type: 'doughnut',
        data: DoughnutData2
    });
    //FIN SEGUNDA GRAFICA

    let isEditing = false;

    $('#edit-button').on('click', function () {
        isEditing = !isEditing;
        if (isEditing) {
            $('#profile-info').addClass('hidden');
            $('#profile-edit').removeClass('hidden');
            $('#edit-button').text('Cancelar');
            $('#edit-button').removeClass('bg-green-700');
            $('#edit-button').addClass('bg-red-600');
        } else {
            $('#profile-info').removeClass('hidden');
            $('#profile-edit').addClass('hidden');
            $('#edit-button').text('Editar');
            $('#edit-button').removeClass('bg-red-600');
            $('#edit-button').addClass('bg-green-700');
        }
    });

    $('.img-option').on('click', function () {
        $('.img-option').removeClass('img-selected');
        $(this).addClass('img-selected');
        const newImage = $(this).attr('data-image');
        $('input#imageProfile').val(newImage);
    });

</script>

</html>